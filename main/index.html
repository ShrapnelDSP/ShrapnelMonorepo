<!DOCTYPE html>
<meta charset="UTF-8">

<head>
    <title> Gain </title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸŽ¸</text></svg>">
</head>

<body>
    <h1>Gain</h1>
    <input type="range" min="-20" max="0" value="-6" class="slider" id="myRange">
    <div id="rangeLabel"></div>

    <script> 
        let socket = new WebSocket("ws://" + window.location.host + "/websocket");
        let block_slider_change = false;

        let slider = document.getElementById("myRange")
        let rangeLabel = document.getElementById("rangeLabel")

        let sendtime = 0;
        let recvtime = 0;

        setLabel = function(v)
        {
            rangeLabel.innerHTML = v + " dB";
        }

        slider.oninput = function()
        {
            console.log("slider changed to: " + this.value);
            sendtime = performance.now();
            socket.send(this.value);
            block_slider_change = true;
            //we will take control of the slider for 2 seconds after the user
            //has adjusted it. This will ignore echo messages generated by us,
            //as well as any messages generated by other clients 
            setTimeout(function () { block_slider_change = false; }, 2000)

            setLabel(this.value);
        }

        socket.onmessage = function(event) {
            recvtime = performance.now();
            console.log("time difference: " + (recvtime - sendtime) + " ms")
            let message = event.data;
            let f = parseFloat(message)
            console.log("got websocket message: " + f);

            if(!block_slider_change)
            {
                slider.value = f;
                setLabel(f);
            }
        }
    </script> 
</body>
